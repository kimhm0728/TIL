# Service
- 백그라운드에서 오래 실행되는 작업을 수행할 수 있는 구성 요소
- 다른 구성 요소가 서비스를 시작할 수 있다.
- 사용자가 다른 애플리케이션으로 전환하더라도 백그라운드에서 계속 실행된다.
- 구성 요소를 서비스에 바인딩하여 상호작용하거나, 프로세스 간 통신(IPC)를 수행할 수 있다.
	- ex) 네트워크 트랜잭션 처리
	- `ContentProvider`와 상호작용

## 서비스 유형
- **포그라운드**
	- 사용자에게 잘 보이는 작업을 수행한다.
		- ex) 오디오 트랙을 재생할 때 사용
	- `Notification`을 반드시 표시해야 한다.
	- 사용자가 애플리케이션과 상호작용하지 않을 때도 계속 실행된다.
- **백그라운드**
	- 사용자에게 직접 보이지 않는 작업을 수행한다.
		- ex) 저장소 압축
	- *API 26 이상 -> 앱이 포그라운드에 있지 않을 때, 백그라운드 서비스 실행을 제한한다. `WorkManager`, `AlarmManager` 등으로 작업을 예약해야 한다.*
- **바인드**
	- 다른 구성 요소가 `bindService()`를 호출하여 서비스에 바인딩한다.
	- 클라이언트-서버 인터페이스를 제공한다.
		- 구성 요소가 서비스와 상호작용하고 결과를 받을 수 있다.
		- 여러 프로세스에 걸쳐 프로세스 간 통신(IPC)을 수행할 수 있다.
	- 여러 개의 구성 요소가 하나의 서비스에 바인딩될 수 있다. 바인딩 해제시 서비스가 소멸된다.

## 서비스 vs 스레드
- 서비스는 기본적으로 메인 스레드에서 실행된다.
- 별도의 스레드를 사용하도록 지정
	- 서비스가 긴 작업을 수행해야 할 경우 ANR 오류가 일어날 위험을 줄일 수 있다.
	- 메인 스레드는 UI 작업만 수행하도록 한다.
- 앱이 실행 중일 때만 필요한 기능이라면 서비스가 아닌 스레드를 사용한다.


|서비스|스레드|
|------|---|
|안드로이드 구성 요소|os 구성 요소|
|메인 스레드|자체 스레드|
|액티비티와 별도의 생명 주기를 가진다.|별도의 생명주기가 없고, 액티비티에 종속된다.|


## 서비스 콜백 함수
- `onStartCommand()`
	- 다른 구성 요소가 서비스를 시작(`startService()`)하는 경우 호출된다.
	- `onStartDCommand()`가 실행되면 서비스가 시작되고 백그라운드에서 무한히 실행된다.
	- 서비스 작업이 완료되었을 때 `stopSelf()`, `stopService()`를 호출하여 서비스를 중단할 수 있다.
	- 바인딩만 제공하는 경우 구현하지 않아도 된다.
- `onBind()`
	- 다른 구성 요소가 서비스를 바인딩(`bindService()`)할 때 호출된다.
	- 클라이언트가 서비스와 통신하기 위한 인터페이스를 제공해야 한다.
		- `IBinder`를 반환한다.
		- 바인딩을 허용하지 않으려면 `null`을 반환한다.
- `onCreate()`
	- 서비스가 처음 생성되었을 때 호출된다.
	- 서비스에 대한 초기 설정을 수행한다.
- `onDestroy()`
	- 서비스를 소멸시킬 때 호출된다.
	- 각종 리소스를 해제한다.

- `onCreate()` -> `onStartCommand()` / `onBind()` -> `onDestroy()`

- started 서비스
	- 포그라운드, 백그라운드
	- 다른 구성 요소에서 `startService()`를 호출한다.
	- 서비스의 `onStartCommand()`콜백이 호출된다.
	- 서비스가 `stopSelf()`로 스스로 중단하거나, 다른 구성 요소가 `stopService()`로 중단할 때까지 실행된다.
- bound 서비스
	- 바인드
	- 다른 구성 요소에서 `bindService()`를 호출한다.
	- 서비스의 `onBind()` 콜백이 호출된다.
	- 모든 클라이언트의 바인딩이 해제되면 서비스가 자동으로 소멸된다.

## 서비스 강제 중단
- 메모리가 부족하여 사용자가 포커스를 둔 액티비티를 위해 메모리를 확보해야 하는 경우, 시스템이 서비스를 강제 중단한다.
- 메모리가 확보되면 가능한 한 빨리 서비스를 다시 시작한다.
- 강제 중단 대상이 될 가능성이 큰 서비스
	- 장시간 실행 중인 서비스
	- 시스템은 백그라운드 작업 목록에서 이 서비스의 우선 순위를 낮춘다.
- 강제 중단 대상이 될 가능성이 적은 서비스
	- 사용자 포커스를 가진 액티비티와 바인딩된 서비스
	- 포그라운드에서 실행되는 서비스
